<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>alexhatchl — spiegel</title>
  <style>
    html,body{
      height:100%; margin:0; background:#0a0c20; overflow:hidden;
    }
    canvas{
      position:fixed; inset:0; width:100%; height:100%;
      display:block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    #plants{ z-index:5; pointer-events:none; }
  </style>
</head>
<body>
  <!-- Wasser -->
  <canvas id="water"></canvas>
  <!-- Pflanzen -->
  <canvas id="plants"></canvas>

  <script>
  (function(){
    const IMG_WATER = "images/BG_1.png";
    const IMG_PLANTS = "images/BG_MASK.png";

    const cWater  = document.getElementById("water");
    const cPlants = document.getElementById("plants");
    const wtx = cWater.getContext("2d",{alpha:false});
    const ptx = cPlants.getContext("2d");

    const buf = document.createElement("canvas");
    const bufx = buf.getContext("2d");

    let imgWater = new Image();
    let imgPlants = new Image();

    imgWater.onload  = ()=>{ fit(); start(); };
    imgPlants.onload = ()=>{ fit(); drawPlants(); };

    imgWater.src  = IMG_WATER;
    imgPlants.src = IMG_PLANTS;

    // Offscreen-Canvas für Spiegeltext (kleiner!)
    const textCanvas = document.createElement("canvas");
    const txtx = textCanvas.getContext("2d");
    textCanvas.width = 256;
    textCanvas.height = 64;
    txtx.fillStyle="#fff";
    txtx.font="bold 36px sans-serif";   // kleiner
    txtx.textAlign="center";
    txtx.textBaseline="middle";
    txtx.fillText("alexhatchl", textCanvas.width/2, textCanvas.height/2);

    function fit(){
      const W=innerWidth,H=innerHeight;
      cWater.width=W; cWater.height=H;
      cPlants.width=W; cPlants.height=H;
      buf.width=Math.ceil(W/4); buf.height=Math.ceil(H/4);
      drawPlants();
    }
    window.addEventListener("resize",fit);

    function drawPlants(){
      const W=cPlants.width,H=cPlants.height;
      ptx.clearRect(0,0,W,H);
      ptx.imageSmoothingEnabled=false;
      const sR=imgPlants.width/imgPlants.height, dR=W/H;
      let dw=W, dh=Math.round(W/sR);
      if(dh<H){ dh=H; dw=Math.round(H*sR); }
      const dx=(W-dw)/2, dy=(H-dh)/2;
      ptx.drawImage(imgPlants,0,0,imgPlants.width,imgPlants.height,dx,dy,dw,dh);
    }

    function computeCover(srcW,srcH,dstW,dstH){
      const sR=srcW/srcH, dR=dstW/dstH;
      let sw,sh,sx,sy;
      if(sR>dR){ sh=srcH; sw=Math.round(sh*dR); sx=(srcW-sw)/2; sy=0; }
      else{ sw=srcW; sh=Math.round(sw/dR); sx=0; sy=(srcH-sh)/2; }
      return {sx,sy,sw,sh};
    }

    function frame(t){
      const W=cWater.width,H=cWater.height;
      const cover=computeCover(imgWater.width,imgWater.height,buf.width,buf.height);

      // Wasser in Buffer mit Wellen
      for(let y=0;y<buf.height;y++){
        const sy=cover.sy+(y/buf.height)*cover.sh;
        const shift=Math.sin(y/12+t*0.002)*6; // horizontale Wellen
        bufx.drawImage(imgWater,
          cover.sx+shift,sy,cover.sw,1,
          0,y,buf.width,1
        );
      }

      // Spiegeltext einfügen (klein, in der Mitte)
      const textX = buf.width/2 - textCanvas.width/2;
      const textY = Math.floor(buf.height*0.5 - textCanvas.height/2);
      bufx.globalAlpha=0.15; // sehr subtil
      bufx.drawImage(textCanvas, textX, textY);
      bufx.globalAlpha=1.0;

      // Buffer → Canvas
      const sR=buf.width/buf.height;
      let dw=W, dh=Math.round(W/sR); if(dh<H){ dh=H; dw=Math.round(H*sR);}
      const dx=(W-dw)/2, dy=(H-dh)/2;
      wtx.imageSmoothingEnabled=false;
      wtx.drawImage(buf,0,0,buf.width,buf.height,dx,dy,dw,dh);

      requestAnimationFrame(frame);
    }

    function start(){ requestAnimationFrame(frame); }
  })();
  </script>
</body>
</html>
