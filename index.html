<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>alexhatchl — portfolio</title>

  <!-- WebSlides CSS -->
  <link rel="stylesheet" href="https://webslides.tv/static/css/webslides.css" />
  <link rel="stylesheet" href="https://webslides.tv/static/css/svg-icons.css" />

  <style>
    #slide-water {
      position: relative;
      overflow: hidden;
      background: #0a0c20;
    }
    #slide-water .stage {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      pointer-events: none;
    }
    #waterCanvas  { z-index: 0; }
    #plantsCanvas { z-index: 1; }
    #slide-water .title-overlay {
      position: relative; z-index: 2;
      height: 100%;
      display: grid; place-items: center;
      pointer-events: none;
    }
    #slide-water .title-overlay h1 {
      margin: 0;
      color: #fff;
      font-size: clamp(28px, 6vw, 64px);
      opacity: 0; /* Text selbst unsichtbar, Spiegel kommt aus Wasser */
    }

    /* WebSlides UI sichtbar */
    .ws-controls,
    .ws-progress,
    .ws-prev,
    .ws-next {
      z-index: 1000 !important;
      opacity: 1 !important;
      visibility: visible !important;
    }
    .ws-progress { background: rgba(255,255,255,.15) !important; }
    .ws-progress .indicator { background: #fff !important; }
  </style>
</head>
<body>

<main role="main">
  <article id="webslides">

    <!-- SLIDE 1 -->
    <section id="slide-water" class="fullscreen aligncenter">
      <canvas id="waterCanvas"  class="stage" aria-hidden="true"></canvas>
      <canvas id="plantsCanvas" class="stage" aria-hidden="true"></canvas>
      <div class="title-overlay"><h1>alexhatchl</h1></div>
    </section>

    <!-- SLIDE 2 (Dummy für Navigation) -->
    <section class="aligncenter">
      <div class="wrap">
        <h2>Weiter</h2>
        <p>Hier kommt dein weiterer Portfolio-Inhalt.</p>
      </div>
    </section>

  </article>
</main>

<!-- WebSlides JS -->
<script src="https://webslides.tv/static/js/webslides.js"></script>
<script>
  window.ws = new WebSlides();
</script>

<script>
(function() {
  const IMG_WATER  = 'images/BG_1.png';
  const IMG_PLANTS = 'images/BG_MASK.png';

  const section = document.getElementById('slide-water');
  const cWater  = document.getElementById('waterCanvas');
  const cPlants = document.getElementById('plantsCanvas');
  const wtx = cWater.getContext('2d', { alpha: false, desynchronized: true });
  const ptx = cPlants.getContext('2d');
  wtx.imageSmoothingEnabled = false;
  ptx.imageSmoothingEnabled = false;

  const buf  = document.createElement('canvas');
  const bufx = buf.getContext('2d', { alpha: false });
  bufx.imageSmoothingEnabled = false;

  const imgWater  = new Image();
  const imgPlants = new Image();
  let waterReady=false, plantsReady=false;

  imgWater.onload  = () => { waterReady = true; fit(); start(); };
  imgPlants.onload = () => { plantsReady = true; fit(); drawPlants(); };
  imgWater.src  = IMG_WATER + '?v=' + Date.now();
  imgPlants.src = IMG_PLANTS + '?v=' + Date.now();

  // Spiegeltext (30% kleiner, türkis)
  const textCanvas = document.createElement('canvas');
  const txtx = textCanvas.getContext('2d');
  textCanvas.width = 180;   // vorher 256 → ca. 30 % kleiner
  textCanvas.height = 46;   // vorher 64
  txtx.fillStyle = 'rgba(64, 224, 208, 0.6)'; // Türkis transparent
  txtx.font = 'bold 24px sans-serif';          // kleiner
  txtx.textAlign = 'center';
  txtx.textBaseline = 'middle';
  txtx.fillText('alexhatchl', textCanvas.width/2, textCanvas.height/2);

  function fit() {
    const r = section.getBoundingClientRect();
    cWater.width  = Math.max(2, Math.floor(r.width));
    cWater.height = Math.max(2, Math.floor(r.height));
    cPlants.width = cWater.width;
    cPlants.height= cWater.height;

    const px = (Math.min(r.width, r.height) < 820) ? 3 : 4;
    buf.width  = Math.ceil(cWater.width  / px);
    buf.height = Math.ceil(cWater.height / px);

    if (plantsReady) drawPlants();
  }
  new ResizeObserver(fit).observe(section);
  window.addEventListener('ws:slide-change', fit, { passive: true });

  function drawPlants() {
    const W = cPlants.width, H = cPlants.height;
    if (!plantsReady) return;
    ptx.clearRect(0,0,W,H);
    const sR = imgPlants.naturalWidth / imgPlants.naturalHeight;
    const dR = W / H;
    let dw = W, dh = Math.round(W / sR);
    if (dh < H) { dh = H; dw = Math.round(H * sR); }
    const dx = Math.round((W - dw)/2), dy = Math.round((H - dh)/2);
    ptx.drawImage(imgPlants, 0,0, imgPlants.naturalWidth, imgPlants.naturalHeight, dx,dy,dw,dh);
  }

  function computeCoverRect(srcW, srcH, dstW, dstH) {
    const sR = srcW/srcH, dR = dstW/dstH;
    let sw, sh, sx, sy;
    if (sR > dR) { sh = srcH; sw = Math.round(sh * dR); sx = Math.round((srcW - sw)/2); sy = 0; }
    else         { sw = srcW; sh = Math.round(sw / dR); sx = 0; sy = Math.round((srcH - sh)/2); }
    return { sx, sy, sw, sh };
  }

  let raf = null, t0 = performance.now();
  function frame(now) {
    const t = (now - t0) * 0.001;
    if (!waterReady) { raf = requestAnimationFrame(frame); return; }

    const W = cWater.width, H = cWater.height;
    const cover = computeCoverRect(imgWater.naturalWidth, imgWater.naturalHeight, buf.width, buf.height);

    for (let y=0; y<buf.height; y++) {
      const sy = cover.sy + (y / buf.height) * cover.sh;
      const shift = Math.sin(y/12 + t*0.9) * 6;
      bufx.drawImage(
        imgWater,
        cover.sx + shift, Math.floor(sy), Math.max(1, cover.sw - Math.abs(shift)), 1,
        0, y, buf.width, 1
      );
    }

    // Spiegeltext klein + türkis, mittig
    const tx = Math.floor(buf.width/2  - textCanvas.width/2);
    const ty = Math.floor(buf.height/2 - textCanvas.height/2);
    bufx.globalAlpha = 0.25; // etwas sichtbarer als vorher
    bufx.drawImage(textCanvas, tx, ty);
    bufx.globalAlpha = 1;

    const sR = buf.width / buf.height;
    let dw = W, dh = Math.round(W / sR);
    if (dh < H) { dh = H; dw = Math.round(H * sR); }
    const dx = Math.round((W - dw)/2), dy = Math.round((H - dh)/2);
    wtx.imageSmoothingEnabled = false;
    wtx.drawImage(buf, 0,0, buf.width, buf.height, dx,dy,dw,dh);

    raf = requestAnimationFrame(frame);
  }

  function start() {
    if (!raf) raf = requestAnimationFrame(frame);
  }
})();
</script>

</body>
</html>
