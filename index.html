<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>alexhatchl — kinetic grid</title>

  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@500;700&family=Inter:wght@600&display=swap" rel="stylesheet">

  <style>
    html,body{height:100%;margin:0;background:#f4f4f4;overflow:hidden}
    canvas#stage{
      position:fixed; inset:0; width:100vw; height:100vh; z-index:1;
      image-rendering: pixelated; image-rendering: crisp-edges; display:block;
    }
    canvas#ui{
      position:fixed; inset:0; width:100vw; height:100vh; z-index:2;
      display:block; pointer-events:none;
    }

    /* compact legend */
    .legend{
      position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
      background:rgba(30,30,30,.72); color:#fff;
      padding:4px 10px; border-radius:8px;
      font:11px/1 "Work Sans",system-ui,sans-serif;
      backdrop-filter:blur(2px);
      display:flex; gap:12px; z-index:8;
    }
    .keys{display:inline-flex;gap:4px;align-items:center}
    .key{
      min-width:14px;height:14px;padding:0 4px;
      border:1px solid rgba(255,255,255,.4);
      border-radius:3px;
      display:inline-flex;align-items:center;justify-content:center;
      font:10px/1 "Inter",system-ui,sans-serif;
      background:rgba(255,255,255,.12)
    }
  </style>
</head>
<body>

<canvas id="stage"></canvas>
<canvas id="ui"></canvas>

<!-- tiny legend -->
<div class="legend" id="legend">
  <span class="keys"><span class="key">←</span><span class="key">→</span> Slides</span>
  <span class="keys"><span class="key">Space</span> Play</span>
  <span class="keys"><span class="key">R</span> Layout</span>
  <span class="keys"><span class="key">C</span> Colors</span>
  <span class="keys"><span class="key">B</span> Pixel</span>
  <span class="keys"><span class="key">F</span> Font</span>
  <span class="keys"><span class="key">H</span> Help</span>
</div>

<script>
(() => {
  const stage=document.getElementById('stage');
  const stx=stage.getContext('2d',{alpha:false});
  stx.imageSmoothingEnabled=false;
  const ui=document.getElementById('ui');
  const utx=ui.getContext('2d',{alpha:true});
  utx.imageSmoothingEnabled=true;
  const buf=document.createElement('canvas');
  const btx=buf.getContext('2d',{alpha:false});
  btx.imageSmoothingEnabled=false;

  let PIX=4,paused=false,fontIndex=0;
  const FONTS=[
    `"Work Sans",system-ui,sans-serif`,
    `"Inter",system-ui,sans-serif`
  ];
  function resize(){
    stage.width=window.innerWidth;
    stage.height=window.innerHeight;
    ui.width=stage.width;ui.height=stage.height;
    buf.width=Math.ceil(stage.width/PIX);
    buf.height=Math.ceil(stage.height/PIX);
  }
  window.addEventListener('resize',resize);resize();

  const COLORS={white:'#fff',red:'#E6432E',yellow:'#F4D21F',blue:'#1A3D9A',black:'#111'};
  const PALETTE=[COLORS.white,COLORS.red,COLORS.yellow,COLORS.blue];
  const pick=()=>PALETTE[Math.random()*PALETTE.length|0];
  const other=(base)=>PALETTE.filter(c=>c!==base)[Math.random()*3|0];

  let vLines,hLines,vCur,vTarget,hCur,hTarget,cells;
  const WORD="alexhatchl";let textRow=0,groups=[];
  function seed(){
    const nV=3+(Math.random()*3|0),nH=3+(Math.random()*3|0);
    const rand=n=>{const s=new Set();while(s.size<n)s.add(Math.random());return[...s].sort((a,b)=>a-b)};
    vLines=[0,...rand(nV),1];hLines=[0,...rand(nH),1];
    vCur=vLines.slice();hCur=hLines.slice();vTarget=vCur.slice();hTarget=hCur.slice();
    cells=[];for(let j=0;j<hLines.length-1;j++){const row=[];for(let i=0;i<vLines.length-1;i++)row.push(pick());cells.push(row);}
    textRow=(hLines.length/2)|0;groups=WORD.split('');
  }
  seed();

  function draw(){
    const W=buf.width,H=buf.height;
    btx.fillStyle="#F6F6F6";btx.fillRect(0,0,W,H);
    for(let j=0;j<hCur.length-1;j++){
      const y0=Math.round(hCur[j]*H),y1=Math.round(hCur[j+1]*H);
      for(let i=0;i<vCur.length-1;i++){
        const x0=Math.round(vCur[i]*W),x1=Math.round(vCur[i+1]*W);
        btx.fillStyle=cells[j][i];
        btx.fillRect(x0,y0,x1-x0,y1-y0);
      }
    }
    const L=Math.max(2,Math.round(Math.min(W,H)*0.008));
    btx.fillStyle=COLORS.black;
    for(let i=0;i<vCur.length;i++){const x=Math.round(vCur[i]*W)-(L>>1);btx.fillRect(x,0,L,H);}
    for(let j=0;j<hCur.length;j++){const y=Math.round(hCur[j]*H)-(L>>1);btx.fillRect(0,y,W,L);}
    stx.drawImage(buf,0,0,W,H,0,0,stage.width,stage.height);

    utx.clearRect(0,0,ui.width,ui.height);
    const cols=vCur.length-1;
    const ry0=Math.round(hCur[textRow]*H),ry1=Math.round(hCur[textRow+1]*H);
    const y0=Math.round(ry0*(stage.height/H)),y1=Math.round(ry1*(stage.height/H));
    const cy=(y0+y1)>>1;
    utx.font=`600 11px ${FONTS[fontIndex]}`;utx.textAlign='center';utx.textBaseline='middle';
    for(let i=0;i<cols;i++){
      const g=groups[i]||'';if(!g)continue;
      const x0=Math.round(vCur[i]*W),x1=Math.round(vCur[i+1]*W);
      const cx=((x0+x1)/2)*(stage.width/W);
      utx.fillStyle=other(cells[textRow][i]);
      utx.fillText(g,cx,cy);
    }
  }

  function loop(){if(!paused){draw();}requestAnimationFrame(loop);}
  loop();

  window.addEventListener('keydown',e=>{
    if(e.key===' ')paused=!paused;
    if(e.key==='r')seed();
    if(e.key==='c'){for(let j=0;j<cells.length;j++)for(let i=0;i<cells[j].length;i++)cells[j][i]=pick();}
    if(e.key==='b'){PIX=(PIX===4?6:(PIX===6?3:4));resize();}
    if(e.key==='f'){fontIndex=(fontIndex+1)%FONTS.length;}
  });
})();
</script>
</body>
</html>
